

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> cli/companyCLIwizard.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Classes</h3><ul><li><a href="AddCompany.html">AddCompany</a></li><li><a href="Auth.html">Auth</a></li><li><a href="baseObjects.html">baseObjects</a></li><li><a href="CLIUtilities.html">CLIUtilities</a></li><li><a href="Companies.html">Companies</a></li><li><a href="CompanySection.html">CompanySection</a></li><li><a href="CompanyStandalone.html">CompanyStandalone</a></li><li><a href="DOCXUtilities.html">DOCXUtilities</a></li><li><a href="Interactions.html">Interactions</a></li><li><a href="InteractionSection.html">InteractionSection</a></li><li><a href="InteractionStandalone.html">InteractionStandalone</a></li><li><a href="mrRest.html">mrRest</a></li><li><a href="Studies.html">Studies</a></li><li><a href="Users.html">Users</a></li><li><a href="Utilities.html">Utilities</a></li></ul><h3>Global</h3><ul><li><a href="global.html#basicComparisonRow">basicComparisonRow</a></li><li><a href="global.html#basicRow">basicRow</a></li><li><a href="global.html#basicTopicRow">basicTopicRow</a></li><li><a href="global.html#checkFilesystemObject">checkFilesystemObject</a></li><li><a href="global.html#createObj">createObj</a></li><li><a href="global.html#createZIPArchive">createZIPArchive</a></li><li><a href="global.html#deleteObj">deleteObj</a></li><li><a href="global.html#descriptionRow">descriptionRow</a></li><li><a href="global.html#extractZIPArchive">extractZIPArchive</a></li><li><a href="global.html#findById">findById</a></li><li><a href="global.html#findByName">findByName</a></li><li><a href="global.html#findByX">findByX</a></li><li><a href="global.html#getAll">getAll</a></li><li><a href="global.html#getConfig">getConfig</a></li><li><a href="global.html#getEnv">getEnv</a></li><li><a href="global.html#getObj">getObj</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#makeBookmark">makeBookmark</a></li><li><a href="global.html#makeBullet">makeBullet</a></li><li><a href="global.html#makeComparisonDOCX">makeComparisonDOCX</a></li><li><a href="global.html#makeDescriptionsDOCX">makeDescriptionsDOCX</a></li><li><a href="global.html#makeDocx">makeDocx</a></li><li><a href="global.html#makeDOCX">makeDOCX</a></li><li><a href="global.html#makeExternalHyperLink">makeExternalHyperLink</a></li><li><a href="global.html#makeFirmographicsDOCX">makeFirmographicsDOCX</a></li><li><a href="global.html#makeHeading1">makeHeading1</a></li><li><a href="global.html#makeHeading2">makeHeading2</a></li><li><a href="global.html#makeHeading3">makeHeading3</a></li><li><a href="global.html#makeHeadingBookmark1">makeHeadingBookmark1</a></li><li><a href="global.html#makeHeadingBookmark2">makeHeadingBookmark2</a></li><li><a href="global.html#makeInternalHyperLink">makeInternalHyperLink</a></li><li><a href="global.html#makeIntro">makeIntro</a></li><li><a href="global.html#makeParagraph">makeParagraph</a></li><li><a href="global.html#makeReferencesDOCX">makeReferencesDOCX</a></li><li><a href="global.html#makeTextrun">makeTextrun</a></li><li><a href="global.html#outputCLI">outputCLI</a></li><li><a href="global.html#pageBreak">pageBreak</a></li><li><a href="global.html#parseCLIArgs">parseCLIArgs</a></li><li><a href="global.html#patchObj">patchObj</a></li><li><a href="global.html#postObj">postObj</a></li><li><a href="global.html#rankTags">rankTags</a></li><li><a href="global.html#readTextFile">readTextFile</a></li><li><a href="global.html#rmDir">rmDir</a></li><li><a href="global.html#s3DownloadObjs">s3DownloadObjs</a></li><li><a href="global.html#safeMakedir">safeMakedir</a></li><li><a href="global.html#saveTextFile">saveTextFile</a></li><li><a href="global.html#splasgScreen">splasgScreen</a></li><li><a href="global.html#topicTable">topicTable</a></li><li><a href="global.html#updateObj">updateObj</a></li><li><a href="global.html#urlRow">urlRow</a></li><li><a href="global.html#wizard">wizard</a></li><li><a href="global.html#writeReport">writeReport</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>cli/companyCLIwizard.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * A class used to build CLIs for accessing and reporting on mediumroast.io objects
 * @author Michael Hay &lt;michael.hay@mediumroast.io>
 * @file companyCLIwizard.js
 * @copyright 2022 Mediumroast, Inc. All rights reserved.
 * @license Apache-2.0
 * @version 1.0.0
 */


// Import required modules
import inquirer from "inquirer"
import chalk from 'chalk'
import ora from "ora"
import mrRest from "../api/scaffold.js"

class AddCompany {
    /**
     * A class which encodes the steps needed to create a company in the mediumroast.io application. There are two
     * modes of the automated case and the manual case.  For the automated case, the method wizard() will call
     * to the open source company_dns service enabling many of the attributes of a company to be automatically
     * filled in.  It is generally suggested for the user to run the automated case to minimze the burden of
     * adding the attributes.  However, in some cases running a manual process isn't avoidable, this could be
     * because the company name is incorrrect or the company isn't in the Wikipedia.  As a result the user
     * can choose to enable a fully manual process to add a company object.  In this mode the default value
     * for each attribute is 'Unknown'.
     * @constructor
     * @classdesc Construct the object to execute the company wizard
     * @param {Object} env - contains key items needed to interact with the mediumroast.io application
     * @param {Object} apiController - an object used to interact with the backend for companies
     * @param {Object} credential - a credential needed to talk to a RESTful service which is the company_dns in this case
     * @param {Object} cli - the already constructed CLI object
     * @param {String} companyDNSUrl - the url to the company DNS service
     */
    constructor(env, apiController, credential, cli, companyDNSUrl="http://cherokee.from-ca.com:16868"){
        this.env = env
        this.apiController = apiController
        this.credential = credential
        this.endpoint = "/V2.0/company/merged/firmographics/"
        this.credential.restServer = companyDNSUrl
        this.rest = new mrRest(this.credential)
        this.cli = cli

        // Splash screen elements
        this.name = "mediumroast.io Company Wizard"
        this.version = "version 1.0.0"
        this.description = "Prompt based company object creation for the mediumroast.io."

        // Class globals
        this.defaultValue = "Unknown"
        this.objectType = "Companies"
    }


    async  getCompany () {
        let myCompany = {}
        const mySpinner = new ora('Attempting to fetch data from company_dns...')
        await inquirer
                .prompt([
                    {
                        name: 'company',
                        type: 'input',
                        message: 'What\'s the name of the company you\'d like to add?'
                    }
                ])
                .then(async (answer) => { 
                    mySpinner.start()
                    const companyAnswer = await answer.company
                    myCompany = await this.rest.getObj(this.endpoint + companyAnswer)
                })
        mySpinner.stop()
        return myCompany
    }

    async  operationOrNot(myStep) {
        let doOperation = null 
        await inquirer
                .prompt([
                    {
                        name: "operation",
                        type: "confirm",
                        message: myStep
                    }
                ])
                // If we don't want to perform the setup then exit
                .then((answer) => {
                        doOperation = answer.operation
                    }
                )
        return doOperation
    }

    async  doManual(prototype, summary=false) {
        let myCompanyObj = {}
        for (const setting in prototype) {
            if (summary) {
                // This is the whitelist of items to manually ask for should we want to do summary verification
                if (![
                    'description', 
                    'name', 
                    'phone', 
                    'website', 
                    'street_address', 
                    'country',
                    'logo_url',
                    'role', 
                    'city'].includes(setting)) {
                    myCompanyObj[setting] = prototype[setting].value
                    continue
                }
            }
            await inquirer
                .prompt([
                    {
                        name: setting,
                        type: 'input',
                        message: 'What\'s the company\'s ' + prototype[setting].consoleString + '?',
                        default() {
                            return prototype[setting].value
                        }
                    }
                ])
                .then(async (answer) => {
                    myCompanyObj[setting] = await answer[setting]
                })
        }
        // Add topics and comparison as empty objects.
        // Needed to ensure that we're including all required attributes before POSTing to the backend.
        myCompanyObj.topics = {}
        myCompanyObj.comparison = {}
        return myCompanyObj
    }

    _joinIndustry(industry) {
        if(industry.length > 1) {
            return industry.join('|')
        } else if (industry === 'Unknown') {
            return 'Unknown'
        } else {
            return industry[0]
        }
    }

    _getFormUrls(forms){
        let tenQ = 'Unknown'
        let tenK = 'Unknown'
        const sortedForms = Object.keys(forms).sort().reverse()
        for (const form in sortedForms) {
            const formType = forms[sortedForms[form]].formType
            if (formType.search(/10-Q/g)) {
                tenQ = forms[sortedForms[form]].filingIndex
                if(tenK !== 'Unknown') {break}
            } else if (formType.search(/10-K/g)) {
                tenK = forms[sortedForms[form]].filingIndex
                if(tenQ !== 'Unknown') {break}
            } else {
                continue
            }
        }
        return [tenK, tenQ]
    }


    async  doAutomatic(prototype){
        let myCompanyObj = await this.getCompany()
        // Else attempt to search company_dns, but if there is no answer then ask if try again or manual
        if (!myCompanyObj[0]){
            const redo = await this.operationOrNot('There was no company matching your search. Would you like to try again?')
            if (redo) {
                myCompanyObj = await this.doAutomatic(prototype)
            } else {
                console.log(chalk.blue.bold('Starting manual company creation process...'))
                myCompanyObj = await this.doManual(prototype)
            }
        } else {
            const myCompany = myCompanyObj[2].data
            // Transform the company_dns  object into a company object suitable for mediumroast

            // Company name
            'name' in myCompany ? prototype.name.value = myCompany.name : prototype.name.value = prototype.name.value

            // Company industry
            let myIndustry = this.defaultValue
            'industry' in myCompany ? myIndustry = this._joinIndustry(myCompany.industry) : myIndustry = this.defaultValue
            prototype.industry.value = myIndustry

            // Company website
            'website' in myCompany ? prototype.url.value = myCompany.website[0] : prototype.url.value = prototype.url.value

            // Company address
            'address' in myCompany ? prototype.street_address.value = myCompany.address : prototype.street_address.value = prototype.street_address.value

            // Company city
            'city' in myCompany ? prototype.city.value = myCompany.city : prototype.city.value = prototype.city.value

            // Company state/province
            'stateProvince' in myCompany ? prototype.state_province.value = myCompany.stateProvince : 
                prototype.state_province.value = prototype.state_province.value

            // Company country
            'country' in myCompany ? prototype.country.value = myCompany.country : prototype.country.value = prototype.country.value

            // Company phone
            'phone' in myCompany ? prototype.phone.value = myCompany.phone : prototype.phone.value = prototype.phone.value

            // Company description
            'description' in myCompany ? prototype.description.value = myCompany.description : prototype.description.value = prototype.description.value
            // TODO clean description of any quotes either single or double
            prototype.description.value = prototype.description.value.replace(/["']/g, '')

            // Company CIK
            'cik' in myCompany ? prototype.cik.value = myCompany.cik : prototype.cik.value = prototype.cik.value

            // Company stock symbol/ticker
            'tickers' in myCompany ? prototype.stock_symbol.value = myCompany.tickers[0] : 
                prototype.stock_symbol.value = prototype.stock_symbol.value

            // Company stock exchange
            'exchanges' in myCompany ? prototype.stock_exchange.value = myCompany.exchanges[0] : 
                prototype.stock_exchange.value = prototype.stock_exchange.value
            
            // Company zip/postal code
            'zipPostal' in myCompany ? prototype.zip_postal.value = myCompany.zipPostal : 
                prototype.zip_postal.value = prototype.zip_postal.value
            
            // Company longitude coordinate
            'longitude' in myCompany ? prototype.longitude.value = myCompany.longitude : 
                prototype.longitude.value = prototype.longitude.value
            
            // Company latitude
            'latitude' in myCompany ? prototype.latitude.value = myCompany.latitude : prototype.latitude.value = prototype.latitude.value
            
            // Company 10-k and 10-q urls
            let [tenKurl, tenQurl] = [null, null]
            'forms' in myCompany ?  [tenKurl, tenQurl] = this._getFormUrls(myCompany.forms) : [tenKurl, tenQurl] = [this.defaultValue, this.defaultValue]
            tenKurl !== this.defaultValue ? prototype.recent10k_url.value = tenKurl : prototype.recent10k_url.value = prototype.recent10k_url.value
            tenQurl !== this.defaultValue ? prototype.recent10q_url.value = tenQurl : prototype.recent10q_url.value = prototype.recent10q_url.value

            // Company wikipedia url
            'wikipediaURL' in myCompany ? prototype.wikipedia_url.value = myCompany.wikipediaURL : 
                prototype.wikipedia_url.value = prototype.wikipedia_url.value
            
            // Company Standard Industry Code
            'sic' in myCompany ? prototype.sic.value = myCompany.sic : prototype.sic.value = prototype.sic.value

            // Company SIC description
            'sicDescription' in myCompany ? prototype.sic_description.value = myCompany.sicDescription : 
                prototype.sic_description.value = prototype.sic_description.value
            
            // Company type
            'type' in myCompany ? prototype.company_type.value = myCompany.type : 
                prototype.company_type.value = prototype.company_type.value
            
            // Company firmographics url
            'firmographicsURL' in myCompany ? prototype.firmographics_url.value = myCompany.firmographicsURL : 
                prototype.firmographics_url.value = prototype.firmographics_url.value
            
            // Company public filings url
            'filingsURL' in myCompany ? prototype.filings_url.value = myCompany.filingsURL : 
                prototype.filings_url.value = prototype.filings_url.value
            
            // Company stock tractions by individual and institutional owner
            'transactionsByOwner' in myCompany ? prototype.owner_transactions.value = myCompany.transactionsByOwner : 
                prototype.owner_transactions.value = prototype.owner_transactions.value

            // Google maps
            'googleMaps' in myCompany ? prototype.google_maps_url.value = myCompany.googleMaps : 
                prototype.google_maps_url.value = prototype.google_maps_url.value

            // Google news
            'googleNews' in myCompany ? prototype.google_news_url.value = myCompany.googleNews : 
                prototype.google_news_url.value = prototype.google_news_url.value

            // Google finance
            'googleFinance' in myCompany ? prototype.google_finance_url.value = myCompany.googleFinance : 
                prototype.google_finance_url.value = prototype.google_finance_url.value

            // Google patents
            'googlePatents' in myCompany ? prototype.google_patents_url.value = myCompany.googlePatents : 
                prototype.google_patents_url.value = prototype.google_patents_url.value
            
            // After company_dns is successful then ask if we want a summary review or detailed review
            const doSummary = await this.operationOrNot(`Would you like to do a summary review of attributes for ${prototype.name.value}?`)
            if (doSummary) {
                myCompanyObj = await this.doManual(prototype, true)
            } else {
                myCompanyObj = await this.doManual(prototype)
            }

            // Add topics and comparison as empty objects.
            // Needed to ensure that we're including all required attributes before POSTing to the backend.
            myCompanyObj.topics = {}
            myCompanyObj.comparison = {}
        }
        return myCompanyObj
    }

    /**
     * @function wizard
     * @description Invoke the text based wizard process to add a company to the mediumroast.io application
     * @returns {List} - a list containing the result of the interaction with the mediumroast.io backend
     */
    async wizard() {
        // Unless we suppress this print out the splash screen.
        if (this.env.splash) {
            this.cli.splashScreen(
                this.name,
                this.version,
                this.description
            )
        }

        // Set the prototype object which can be used for creating a real object.
        // Since the backend expects certain attributes that may not be human readable, the 
        // prototype below contains strings that are easier to read.  Additionally, should 
        // we wish to set some defaults for each one it is also feasible within this 
        // prototype object to do so.
        let companyPrototype = {
            name: {consoleString: "name", value:this.defaultValue},
            industry: {consoleString: "industry", value:this.defaultValue},
            role: {consoleString: "role", value:this.defaultValue},
            url: {consoleString: "website", value:this.defaultValue},
            street_address: {consoleString: "street address", value:this.defaultValue},
            city: {consoleString: "city", value:this.defaultValue},
            state_province: {consoleString: "state or province", value:this.defaultValue},
            country: {consoleString: "country", value:this.defaultValue},
            region: {consoleString: "region", value:this.defaultValue},
            phone: {consoleString: "phone number", value:this.defaultValue},
            description: {consoleString: "description", value:this.defaultValue},
            cik: {consoleString: "SEC Central Index Key", value:this.defaultValue},
            stock_symbol: {consoleString: "stock ticker", value:this.defaultValue},
            stock_exchange: {consoleString: "stock exchange", value:this.defaultValue},
            recent10k_url: {consoleString: "recent form 10-K URL", value:this.defaultValue},
            recent10q_url: {consoleString: "recent form 10-Q URL", value:this.defaultValue},
            zip_postal: {consoleString: "zip or postal code", value:this.defaultValue},
            longitude: {consoleString: "longitude", value:this.defaultValue},
            latitude: {consoleString: "latitude", value:this.defaultValue},
            logo_url: {consoleString: "logo url", value:this.defaultValue},
            wikipedia_url: {consoleString: "wikipedia url", value:this.defaultValue},
            sic: {consoleString: "Standard Industry Code", value:this.defaultValue},
            sic_description: {consoleString: "Standard Industry Code description", value:this.defaultValue},
            company_type: {consoleString: "company type (e.g. Public, Private, etc.)", value:this.defaultValue},
            firmographics_url: {consoleString: "firmographics detail URL for public companies", value:this.defaultValue},
            filings_url: {consoleString: "filings URL for public companies", value:this.defaultValue},
            owner_transactions: {consoleString: "URL containing share ownership reports", value:this.defaultValue},
            google_maps_url: {consoleString: "URL to locate the company on Google Maps", value:this.defaultValue},
            google_news_url: {consoleString: "URL to find news about the company on Google", value:this.defaultValue},
            google_finance_url: {consoleString: "URL to reveal financial insights on Google", value:this.defaultValue},
            google_patents_url: {consoleString: "URL to locate patent insights on Googles", value:this.defaultValue},
        }

        // Define an empty company object
        let myCompany = {}

        // Choose if we want to run the setup or not, and it not exit the program
        const doSetup = await this.operationOrNot('It appears you\'d like to create a new company, right?')
        if (!doSetup) {
            console.log(chalk.red.bold('\t-> Ok exiting company object creation.'))
            process.exit()
        }

        // Choose if we want manual or automatic
        const automatic = await this.operationOrNot('Would like to proceed with automatic company creation?')
        if (!automatic) {
            // Perform manual setup
            console.log(chalk.blue.bold('Starting manual company creation process...'))
            myCompany = await this.doManual(companyPrototype)
        } else {
            // Perform auto setup
            console.log(chalk.blue.bold('Starting automatic company creation process...'))
            myCompany = await this.doAutomatic(companyPrototype)
        }

        return await this.apiController.createObj(myCompany)
    }

}

export { AddCompany }</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>


</body>
</html>
