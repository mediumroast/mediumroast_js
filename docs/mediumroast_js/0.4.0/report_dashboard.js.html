

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> report/dashboard.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Classes</h3><ul><li><a href="AddCompany.html">AddCompany</a></li><li><a href="AddInteraction.html">AddInteraction</a></li><li><a href="ArchivePackage.html">ArchivePackage</a></li><li><a href="Auth.html">Auth</a></li><li><a href="Auth0Auth.html">Auth0Auth</a></li><li><a href="baseObjects.html">baseObjects</a></li><li><a href="CLIOutput.html">CLIOutput</a></li><li><a href="CLIUtilities.html">CLIUtilities</a></li><li><a href="Companies.html">Companies</a></li><li><a href="CompanyDashbord.html">CompanyDashbord</a></li><li><a href="CompanySection.html">CompanySection</a></li><li><a href="CompanyStandalone.html">CompanyStandalone</a></li><li><a href="DOCXUtilities.html">DOCXUtilities</a></li><li><a href="Environmentals.html">Environmentals</a></li><li><a href="GitHubFunctions.html">GitHubFunctions</a></li><li><a href="Interactions.html">Interactions</a></li><li><a href="InteractionSection.html">InteractionSection</a></li><li><a href="InteractionStandalone.html">InteractionStandalone</a></li><li><a href="MinioUtilities.html">MinioUtilities</a></li><li><a href="mrRest.html">mrRest</a></li><li><a href="s3Utilities.html">s3Utilities</a></li><li><a href="serverOperations.html">serverOperations</a></li><li><a href="Studies.html">Studies</a></li><li><a href="Users.html">Users</a></li><li><a href="Utilities.html">Utilities</a></li><li><a href="WizardUtils.html">WizardUtils</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addConfigSection">addConfigSection</a></li><li><a href="global.html#addMinioUser">addMinioUser</a></li><li><a href="global.html#basicComparisonRow">basicComparisonRow</a></li><li><a href="global.html#basicRow">basicRow</a></li><li><a href="global.html#basicTopicRow">basicTopicRow</a></li><li><a href="global.html#bubbleChart">bubbleChart</a></li><li><a href="global.html#checkConfigDir">checkConfigDir</a></li><li><a href="global.html#checkFilesystemObject">checkFilesystemObject</a></li><li><a href="global.html#checkFilesystemObjectType">checkFilesystemObjectType</a></li><li><a href="global.html#checkServer">checkServer</a></li><li><a href="global.html#cleanWorkingDirs">cleanWorkingDirs</a></li><li><a href="global.html#createContainers">createContainers</a></li><li><a href="global.html#createObj">createObj</a></li><li><a href="global.html#createRepository">createRepository</a></li><li><a href="global.html#createZIPArchive">createZIPArchive</a></li><li><a href="global.html#decodeJWT">decodeJWT</a></li><li><a href="global.html#deleteObj">deleteObj</a></li><li><a href="global.html#descriptionRow">descriptionRow</a></li><li><a href="global.html#doManual">doManual</a></li><li><a href="global.html#downloadBinary">downloadBinary</a></li><li><a href="global.html#extractZIPArchive">extractZIPArchive</a></li><li><a href="global.html#findById">findById</a></li><li><a href="global.html#findByName">findByName</a></li><li><a href="global.html#findByX">findByX</a></li><li><a href="global.html#getAll">getAll</a></li><li><a href="global.html#getConfig">getConfig</a></li><li><a href="global.html#getConfigSetting">getConfigSetting</a></li><li><a href="global.html#getEnv">getEnv</a></li><li><a href="global.html#getGitHubOrg">getGitHubOrg</a></li><li><a href="global.html#getMostSimilarCompany">getMostSimilarCompany</a></li><li><a href="global.html#getObj">getObj</a></li><li><a href="global.html#getOwningCompany">getOwningCompany</a></li><li><a href="global.html#initWorkingDirs">initWorkingDirs</a></li><li><a href="global.html#linkObj">linkObj</a></li><li><a href="global.html#listAllFiles">listAllFiles</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#makeBookmark">makeBookmark</a></li><li><a href="global.html#makeBullet">makeBullet</a></li><li><a href="global.html#makeComparisonDOCX">makeComparisonDOCX</a></li><li><a href="global.html#makeDescriptionsDOCX">makeDescriptionsDOCX</a></li><li><a href="global.html#makeDocx">makeDocx</a></li><li><a href="global.html#makeDOCX">makeDOCX</a></li><li><a href="global.html#makeExternalHyperLink">makeExternalHyperLink</a></li><li><a href="global.html#makeFirmographicsDOCX">makeFirmographicsDOCX</a></li><li><a href="global.html#makeHeader">makeHeader</a></li><li><a href="global.html#makeHeading1">makeHeading1</a></li><li><a href="global.html#makeHeading2">makeHeading2</a></li><li><a href="global.html#makeHeading3">makeHeading3</a></li><li><a href="global.html#makeHeadingBookmark1">makeHeadingBookmark1</a></li><li><a href="global.html#makeHeadingBookmark2">makeHeadingBookmark2</a></li><li><a href="global.html#makeInternalHyperLink">makeInternalHyperLink</a></li><li><a href="global.html#makeIntro">makeIntro</a></li><li><a href="global.html#makeParagraph">makeParagraph</a></li><li><a href="global.html#makeReferencesDOCX">makeReferencesDOCX</a></li><li><a href="global.html#makeTextrun">makeTextrun</a></li><li><a href="global.html#operationOrNot">operationOrNot</a></li><li><a href="global.html#outputCLI">outputCLI</a></li><li><a href="global.html#pageBreak">pageBreak</a></li><li><a href="global.html#parseCLIArgs">parseCLIArgs</a></li><li><a href="global.html#postObj">postObj</a></li><li><a href="global.html#printLine">printLine</a></li><li><a href="global.html#rankTags">rankTags</a></li><li><a href="global.html#readConfig">readConfig</a></li><li><a href="global.html#readJSONFile">readJSONFile</a></li><li><a href="global.html#readTextFile">readTextFile</a></li><li><a href="global.html#refreshAccessToken">refreshAccessToken</a></li><li><a href="global.html#removeConfigSetting">removeConfigSetting</a></li><li><a href="global.html#rmDir">rmDir</a></li><li><a href="global.html#rmObj">rmObj</a></li><li><a href="global.html#s3ArchiveBucket">s3ArchiveBucket</a></li><li><a href="global.html#s3CreateBucket">s3CreateBucket</a></li><li><a href="global.html#s3DeleteBucket">s3DeleteBucket</a></li><li><a href="global.html#s3DownloadObjs">s3DownloadObjs</a></li><li><a href="global.html#s3UploadObjs">s3UploadObjs</a></li><li><a href="global.html#safeMakedir">safeMakedir</a></li><li><a href="global.html#saveTextFile">saveTextFile</a></li><li><a href="global.html#setFilePermissions">setFilePermissions</a></li><li><a href="global.html#splashScreen">splashScreen</a></li><li><a href="global.html#topicTable">topicTable</a></li><li><a href="global.html#updateConfigSetting">updateConfigSetting</a></li><li><a href="global.html#updateObj">updateObj</a></li><li><a href="global.html#urlRow">urlRow</a></li><li><a href="global.html#verifyAccessToken">verifyAccessToken</a></li><li><a href="global.html#wizard">wizard</a></li><li><a href="global.html#writeConfig">writeConfig</a></li><li><a href="global.html#writeReport">writeReport</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>report/dashboard.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Classes to create dashboards for company, interaction and study objects in mediumroast.io documents
 * @author Michael Hay &lt;michael.hay@mediumroast.io>
 * @file dashboard.js
 * @copyright 2023 Mediumroast, Inc. All rights reserved.
 * @license Apache-2.0
 * @version 0.1.0
 */

// Import required modules
import docx from 'docx'
import * as fs from 'fs'
import DOCXUtilities from './common.js'
import docxSettings from './settings.js'
import { bubbleChart, radarChart } from './charts.js'

class CompanyDashbord {
    /**
     * A high class meant to create an initial dashboard page for an MS Word document company report
     * @constructor
     * @classdesc To operate this class the constructor should be passed a the environmental setting for the object.
     * @param {Object} env - Environmental variable settings for the CLI environment
     * @param {String} theme - Governs the color of the dashboard, be either coffee or latte 
     */
    constructor(env) {
        this.env = env
        this.util = new DOCXUtilities()
        this.themeStyle = docxSettings[env.theme] // Set the theme for the report
        this.generalStyle = docxSettings.general // Pull in all of the general settings
        
        // Define specifics for table borders
        this.noneStyle = {
            style: this.generalStyle.noBorderStyle
        }
        this.borderStyle = {
            style: this.generalStyle.tableBorderStyle,
            size: this.generalStyle.tableBorderSize,
            color: this.themeStyle.tableBorderColor
        }
        // No borders
        this.noBorders = {
            left: this.noneStyle,
            right: this.noneStyle,
            top: this.noneStyle,
            bottom: this.noneStyle
        }
        // Right border only
        this.rightBorder = {
            left: this.noneStyle,
            right: this.borderStyle,
            top: this.noneStyle,
            bottom: this.noneStyle
        }
        // Bottom border only
        this.bottomBorder = {
            left: this.noneStyle,
            right: this.noneStyle,
            top: this.noneStyle,
            bottom: this.borderStyle
        }
        // Bottom and right borders
        this.bottomAndRightBorders = {
            left: this.noneStyle,
            right: this.borderStyle,
            top: this.noneStyle,
            bottom: this.borderStyle
        }
        // Top and right borders
        this.topAndRightBorders = {
            left: this.noneStyle,
            right: this.borderStyle,
            top: this.borderStyle,
            bottom: this.noneStyle
        }
        // All borders, helpful for debugging
        this.allBorders = {
            left: this.borderStyle,
            right: this.borderStyle,
            top: this.borderStyle,
            bottom: this.borderStyle
        }
    }

    /**
     * 
     * @param {*} statistics 
     * @returns 
     * @todo turn into a loop instead of having the code repeated
     * @todo if the length of any number is greater than 3 digits shrink the font size by 15% and round down
     */
    _statisticsTable(statistics) {
        const myRows = [
            new docx.TableRow({
                children: [
                    new docx.TableCell({
                        children: [
                            this.makeParagraph(
                                statistics.companyStats,
                                this.generalStyle.metricFontSize,
                                this.themeStyle.titleFontColor,
                                0,
                                true,
                                true,
                                this.generalStyle.heavyFont
                            )
                        ],
                        borders: this.bottomBorder,
                        margins: {
                            top: this.generalStyle.tableMargin
                        }
                    }),
                ]
            }),
            new docx.TableRow({
                children: [
                    new docx.TableCell({
                        children: [
                            this.makeParagraph(
                                statistics.companyStatsTitle,
                                this.generalStyle.metricFontTitleSize,
                                this.themeStyle.titleFontColor,
                                0,
                                false,
                                true
                            )
                        ],
                        borders: this.noBorders,
                        margins: {
                            bottom: this.generalStyle.tableMargin,
                            top: this.generalStyle.tableMargin
                        }
                    }),
                ]
            }),
            new docx.TableRow({
                children: [
                    new docx.TableCell({
                        children: [
                            this.makeParagraph(
                                statistics.averageStats,
                                this.generalStyle.metricFontSize,
                                this.themeStyle.titleFontColor,
                                0,
                                true,
                                true,
                                this.generalStyle.heavyFont
                            )
                        ],
                        borders: this.bottomBorder,
                        margins: {
                            top: this.generalStyle.tableMargin
                        }
                    }),
                ]
            }),
            new docx.TableRow({
                children: [
                    new docx.TableCell({
                        children: [
                            this.makeParagraph(
                                statistics.averageStatsTitle,
                                this.generalStyle.metricFontTitleSize,
                                this.themeStyle.titleFontColor,
                                0,
                                false,
                                true
                            )
                        ],
                        borders: this.noBorders,
                        margins: {
                            bottom: this.generalStyle.tableMargin,
                            top: this.generalStyle.tableMargin
                        }
                    }),
                ]
            }),
            new docx.TableRow({
                children: [
                    new docx.TableCell({
                        children: [
                            this.makeParagraph(
                                statistics.totalStats,
                                this.generalStyle.metricFontSize,
                                this.themeStyle.titleFontColor,
                                0,
                                true,
                                true,
                                this.generalStyle.heavyFont
                            )
                        ],
                        borders: this.bottomBorder,
                        margins: {
                            top: this.generalStyle.tableMargin
                        }
                    }),
                ]
            }),
            new docx.TableRow({
                children: [
                    new docx.TableCell({
                        children: [
                            this.makeParagraph(
                                statistics.totalStatsTitle,
                                this.generalStyle.metricFontTitleSize,
                                this.themeStyle.titleFontColor,
                                0,
                                false,
                                true
                            )
                        ],
                        borders: this.noBorders,
                        margins: {
                            bottom: this.generalStyle.tableMargin,
                            top: this.generalStyle.tableMargin
                        }
                    }),
                ]
            }),
            new docx.TableRow({
                children: [
                    new docx.TableCell({
                        children: [
                            this.makeParagraph(
                                statistics.totalCompanies,
                                this.generalStyle.metricFontSize,
                                this.themeStyle.titleFontColor,
                                0,
                                true,
                                true,
                                this.generalStyle.heavyFont
                            )
                        ],
                        borders: this.bottomBorder,
                        margins: {
                            top: this.generalStyle.tableMargin
                        }
                    }),
                ]
            }),
            new docx.TableRow({
                children: [
                    new docx.TableCell({
                        children: [
                            this.makeParagraph(
                                statistics.totalCompaniesTitle,
                                this.generalStyle.metricFontTitleSize,
                                this.themeStyle.titleFontColor,
                                0,
                                false,
                                true
                            )
                        ],
                        borders: this.noBorders,
                        margins: {
                            bottom: this.generalStyle.tableMargin,
                            top: this.generalStyle.tableMargin
                        }
                    }),
                ]
            }),
        ]
        return new docx.Table({
            columnWidths: [95],
            rows: myRows,
            width: {
                size: 100,
                type: docx.WidthType.PERCENTAGE
            }
        })
    }

    // Create the first row with two images and a nested table
    //     40%      |    40%      |   20%
    // bubble chart | radar chart | nested table for stats
    firstRow (bubbleImage, radarImage, stats) {
        return new docx.TableRow({
            children: [
                new docx.TableCell({
                    children: [this.insertImage(bubbleImage, 226, 259.2)],
                    borders: this.bottomAndRightBorders
                }),
                new docx.TableCell({
                    children: [this.insertImage(radarImage, 226, 345.6)],
                    borders: this.bottomAndRightBorders
                }),
                new docx.TableCell({
                    children: [this._statisticsTable(stats)],
                    borders: this.noBorders,
                    rowSpan: 5,
                    margins: {
                        left: this.generalStyle.tableMargin,
                        right: this.generalStyle.tableMargin,
                        bottom: this.generalStyle.tableMargin,
                        top: this.generalStyle.tableMargin
                    },
                    verticalAlign: docx.VerticalAlign.CENTER,
                }),
            ]
        })
    }

    // A custom table that contains a company logo/name and description
    _companyDescRow(company, descriptionLen=550) {
        // Trim the length of the description to the required size
        let companyDesc = company.company.description
        companyDesc = companyDesc.replace(/\.\.\.|\.$/, '')
        if (companyDesc.length > descriptionLen) {
            companyDesc = companyDesc.substring(0,descriptionLen)
        }
        companyDesc = companyDesc + '...'
        const myRows = [
                new docx.TableRow({
                    children: [
                        new docx.TableCell({
                            children: [
                                this.makeParagraph(
                                        company.company.name, // Text for the paragraph
                                        this.generalStyle.companyNameFontSize, // Font size
                                        this.themeStyle.titleFontColor, // Specify the font color
                                        0, // Set the space after attribute to 0
                                        false, // Set bold to false
                                        true, // Set alignment to center
                                        this.generalStyle.heavyFont // Define the font used
                                    )
                                ],
                            borders: this.noBorders,
                            columnSpan: 2,
                            margins: {
                                top: this.generalStyle.tableMargin
                            }
                        }),
                    ],
            }),
            new docx.TableRow({
                children: [
                    new docx.TableCell({
                        children: [
                            this.makeParagraph(
                                companyDesc, 
                                this.generalStyle.dashFontSize,
                                this.themeStyle.fontColor, 
                                false
                            )
                        ],
                        borders: this.noBorders,
                        margins: {
                            bottom: this.generalStyle.tableMargin,
                            top: this.generalStyle.tableMargin
                        }
                    }),
                ]
            })
        ]   
        return new docx.Table({
            columnWidths: [100],
            rows: myRows,
            width: {
                size: 100,
                type: docx.WidthType.PERCENTAGE
            }
        })
    }

    _docDescRow (
        docs, 
        fileNameLen=25, 
        docLen=460, 
        headerText="Most/Least Similar Interactions",
        mostSimilarRowName="Most similar",
        leastSimilarRowName="Least similar"
    ) {
        // TODO add the header row with colspan=3, centered, and with margins all around to myrows
        let myRows = [
            new docx.TableRow({
                children: [
                    new docx.TableCell({
                        children: [
                            this.makeParagraph(
                                    headerText, 
                                    this.generalStyle.dashFontSize,
                                    this.themeStyle.titleFontColor,
                                    0, // Set the space after attribute to 0
                                    true, // Set bold to true
                                    true, // Set alignment to center
                                    this.generalStyle.heavyFont // Define the font used
                                )
                            ],
                        borders: this.noBorders,
                        columnSpan: 3,
                        margins: {
                            bottom: this.generalStyle.tableMargin,
                            top: this.generalStyle.tableMargin
                        }
                        
                    }),
                ],
        })]
        for(const doc in docs) {
            let docCategoryName = ""
            doc === "most_similar" ? docCategoryName = mostSimilarRowName : docCategoryName = leastSimilarRowName
            // Trim the length of the document name
            let docName = docs[doc].name
            if (docName.length > fileNameLen) {
                docName = docName.substring(0,fileNameLen) + '...'
            }
            // Trim the length of the document description
            let docDesc = docs[doc].description
            docDesc = docDesc.replace(/\.\.\.|\.$/, '')
            if (docDesc.length > docLen) {
                docDesc = docDesc.substring(0,docLen)
            }
            docDesc = docDesc + '...'
            myRows.push(
                    new docx.TableRow({
                        children: [
                            new docx.TableCell({
                                children: [
                                    this.makeParagraph(
                                            docCategoryName, 
                                            this.generalStyle.dashFontSize,
                                            this.themeStyle.fontColor,
                                        )
                                    ],
                                borders: this.noBorders,
                                margins: {
                                    top: this.generalStyle.tableMargin,
                                    left: this.generalStyle.tableMargin,
                                },
                                width: {
                                    size: 15,
                                    type: docx.WidthType.PERCENTAGE
                                }
                            }),
                            new docx.TableCell({
                                children: [
                                    // TODO this needs to be a URL which points to the relevant document
                                    this.makeParagraph(
                                        docName, 
                                        this.generalStyle.dashFontSize,
                                        this.themeStyle.fontColor, 
                                    )
                                ],
                                borders: this.noBorders,
                                margins: {
                                    top: this.generalStyle.tableMargin,
                                    right: this.generalStyle.tableMargin,
                                },
                                width: {
                                    size: 15,
                                    type: docx.WidthType.PERCENTAGE
                                }
                            }),
                            new docx.TableCell({
                                children: [
                                    this.makeParagraph(
                                        docDesc, 
                                        this.generalStyle.dashFontSize,
                                        this.themeStyle.fontColor, 
                                    )
                                ],
                                borders: this.noBorders,
                                margins: {
                                    // left: this.generalStyle.tableMargin,
                                    right: this.generalStyle.tableMargin,
                                    bottom: this.generalStyle.tableMargin,
                                    top: this.generalStyle.tableMargin
                                },
                                width: {
                                    size: 70,
                                    type: docx.WidthType.PERCENTAGE
                                }
                            }),
                        ],
                })
            )
        }
        return new docx.Table({
            columnWidths: [20, 30, 50],
            rows: myRows,
            width: {
                size: 100,
                type: docx.WidthType.PERCENTAGE
            },
        })

    }


    // A shell row to contain company description, document descriptions, etc.
    shellRow (type, company, docs) {
        let myTable = {}
        if (type === "companyDesc") {
            myTable = this._companyDescRow(company)
        } else if (type === "docDesc") {
            myTable = this._docDescRow(docs)
        } else {
            myTable = this._blankRow()
        }
        return new docx.TableRow({
            children: [
                new docx.TableCell({
                    children: [myTable],
                    borders: this.topAndRightBorders,
                    columnSpan: 2,
                })
            ]
        })
    }

    /**
     * 
     * @param {*} imageFile 
     * @param {*} height 
     * @param {*} width 
     * @returns 
     * @todo move to common
     */
    insertImage (imageFile, height, width) {
        const myFile = fs.readFileSync(imageFile)
        return new docx.Paragraph({
            alignment: docx.AlignmentType.CENTER,
            children: [
                new docx.ImageRun({
                    data: myFile,
                    transformation: {
                        height: height,
                        width: width
                    }
                })
            ]
        })
    }

    // Find the closest competitor
    // This uses the Euclidean distantce, given points (x1, y1) and (x2, y2)
    // d = sqrt((x2 - x1)^2 + (y2 - y1)^2) 
    _getMostSimilarCompany(comparisons, companies) {
        const x1 = 1 // In this case x1 = 1 and y1 = 1
        const y1 = 1
        let distances = {}
        for(const companyId in comparisons) {
            const myDistance = Math.sqrt(
                    (comparisons[companyId].most_similar.score - x1) ** 2 + 
                    (comparisons[companyId].least_similar.score - y1) ** 2
                )
            distances[myDistance] = companyId
        }
        const mostSimilarId = distances[Math.min(...Object.keys(distances))]
        const mostSimilarCompany = companies.filter(company => {
            if (parseInt(company.company.id) === parseInt(mostSimilarId)) {
                return company
            }
        })
        return mostSimilarCompany[0]
    }

    // Compute interaction descriptive statistics
    _computeInteractionStats(company, competitors) {
        // Pull out company interactions
        const companyInteractions = Object.keys(company.linked_interactions).length

        // Get the total number of interactions
        // Add the current company interactions to the total
        let totalInteractions = companyInteractions 
        // Sum all other companies' interactions
        for(const competitor in competitors) {
            totalInteractions += Object.keys(competitors[competitor].company.linked_interactions).length
        }

        // Compute the average interactions per company
        const totalCompanies = 1 + competitors.length  
        const averageInteractions = Math.round(totalInteractions/totalCompanies) 

        // Return the result
        return {
            totalStatsTitle: "Total Interactions",
            totalStats: totalInteractions,
            averageStatsTitle: "Average Interactions/Company",
            averageStats: averageInteractions,
            companyStatsTitle: "Interactions",
            companyStats: companyInteractions,
            totalCompaniesTitle: "Total Companies",
            totalCompanies: totalCompanies
        }
    }

    /**
     * 
     * @param {*} paragraph 
     * @param {*} size 
     * @param {*} color 
     * @param {*} spaceAfter 
     * @param {*} bold 
     * @param {*} center 
     * @param {*} font
     * @returns 
     * @todo Replace the report/common.js makeParagraph method with this one during refactoring
     * @todo Add an options object in a future release when refactoring
     * @todo Review the NOTICE section and at a later date work on all TODOs there
     */
    makeParagraph (
        paragraph, 
        size=20, 
        color="000", 
        spaceAfter=0, 
        bold=false, 
        center=false, 
        font="Avenir Next", 
        italics=false, 
        underline=false
    ) {
        size = 2 * size // Font size is measured in half points, multiply by to is needed
        return new docx.Paragraph({
            alignment: center ? docx.AlignmentType.CENTER : docx.AlignmentType.LEFT,
            children: [
                new docx.TextRun({
                    text: paragraph,
                    font: font ? font : "Avenir Next", // Default font: Avenir next
                    size: size ? size : 20, // Default font size size 10pt or 2 * 10 = 20
                    bold: bold ? bold : false, // Bold is off by default
                    italics: italics ? italics : false, // Italics off by default
                    underline: underline ? underline : false, // Underline off by default
                    break: spaceAfter ? spaceAfter : 0, // Defaults to no trailing space after the paragraph
                    color: color ? color : "000", // Default color is black 
                })
            ],
            
        })
    }

    /**
     * @async
     * @param {Object} company - the company the dashboard is for
     * @param {Object} competitors - the competitors to the company
     * @param {String} baseDir - the complete directory needed to store images for the dashboard
     * @returns 
     */
    async makeDashboard(company, competitors, baseDir) {
        // Create the bubble chart from the company comparisons
        const bubbleChartFile = await bubbleChart(
            company.comparison,
            this.env,
            baseDir
        )
        // Find the most similar company
        const mostSimilarCompany = this._getMostSimilarCompany(
            company.comparison, 
            competitors
        )
        // Pull in the relevant interactions from the most similar company
        const mostLeastSimilarInteractions = {
            most_similar: mostSimilarCompany.mostSimilar.interaction,
            least_similar: mostSimilarCompany.leastSimilar.interaction
        }
        // Compute the descriptive statistics for interactions
        const myStats = this._computeInteractionStats(company,competitors)
        // Create the radard chart from supplied interaction quality data
        const radarChartFile = await radarChart(
            {company: company, competitors: competitors, stats: myStats},
            this.env,
            baseDir
        )
        /**
         * NOTICE
         * I believe that there is a potential bug in node.js filesystem module.
         * This file is needed because otherwise the actual final of the two images
         * that needs to be inserted into the docx file won't load.  If we create a
         * scratch file then it will.  Essentially something is off with the last
         * file created in a series of files, but the second to last file appears ok.
         * 
         * Obviously more testing is needed before we approach the node team with something
         * half baked.  Until then here are some observations:
         * 1. Unless the file of a given name is present, even if zero bytes, the image data
         *    will not be put into the file.  If the file name exists then everything works.
         * 2. Again the last file in a series of files appears to be corrupted and cannot, for
         *    some odd reason, be read by the docx module and be inserted into a docx file.
         *    Yet when we look at the file system object within the file system it can be opened
         *    without any problems.
         * 
         * TODOs
         * 1. Create a separate program that emulates what is done in the mrcli dashboard
         * 2. Try on multiple OSes
         * 3. Clearly document the steps and problem encountered
         * 4. In the separate standalone program try using with and without axios use default http without
         */
        const scratchChartFile = await radarChart(
            {company: company, competitors: competitors, stats: myStats},
            this.env,
            baseDir,
            'scratch_chart.png'
        )
        let myRows = [
            this.firstRow(bubbleChartFile, radarChartFile, myStats),
            this.shellRow("companyDesc", mostSimilarCompany),
            this.shellRow("docDesc", null, mostLeastSimilarInteractions),
        ]
        const myTable = new docx.Table({
            columnWidths: [40, 40, 20],
            rows: myRows,
            width: {
                size: 100,
                type: docx.WidthType.PERCENTAGE
            },
            height: {
                size: 100,
                type: docx.WidthType.PERCENTAGE
            }
        })

        return myTable
    }

}

export {
    CompanyDashbord
}</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>


</body>
</html>
